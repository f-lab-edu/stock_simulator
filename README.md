# 실시간 주식 거래 시스템 만들기
실시간 주식 거래 흐름을 백엔드로 구현해보자.

## [주요 기술 스택]
- Spring boot / JPA
- Redis / Kafka
- REST API 
- MySQL(RDBMS)
- AWS EC2 인스턴스를 활용한 배포

## [시스템의 역할]
1. 실시간 데이터 처리가 가능합니다.
   실시간 주가 데이터를 수신하고, 내부 데이터베이스 혹은 메모리 구조에 저장
   가격 변동 및 체결 정보에 대한 이벤트 처리 및 브로드캐스팅

2. 주문 및 체결 처리
   사용자의 매수/매도 주문 생성 및 저장
   주문 조건에 따라 실시간 체결 여부 판단 (가격, 수량 등)
   체결된 주문은 체결 내역에 반영

3. 계좌 및 자산 관리
   각 사용자별 계좌를 관리하고 보유 주식, 예수금, 총 평가 자산 등을 실시간 반영
   체결 결과에 따라 자산 변동 사항 처리

4. 거래 기록 및 리포트 관리
   모든 주문/체결 내역을 기록
   일별/월별 수익률, 총 수익, 거래 빈도 등의 통계 정보 제공

5. 사용자 관리 및 인증
   사용자 로그인, 로그아웃 기능
   사용자별 세션 관리 및 접근 권한 제어


## [사용자가 시스템을 통해 진행할 수 있는 일]
1) 주문 기능
    - 매수 주문 생성: 종목명, 수량, 가격 입력 → 주문 제출
    - 매도 주문 생성: 보유 종목 선택, 수량, 가격 입력 → 주문 제출
    - 시장가/지정가 주문 지원
    - 주문 취소 및 수정 기능

2) 자산 조회 기능
    - 현재 자산 요약: 총 자산, 예수금, 평가 손익
    - 보유 종목 상세: 종목별 수량, 평균 단가, 평가 손익
    - 실시간 반영 기능

3) 거래 내역 조회
    - 주문 내역: 주문 시간, 종목, 수량, 가격, 상태(체결/대기)
    - 체결 내역: 실제 체결 가격, 체결 시간
    - 수익률 및 통계 리포트: 일/주/월 단위 수익률 확인

4) 시뮬레이션 설정
    - 가상 자본 설정: 시작 자금 설정
    - 거래 전략 테스트 모드: 특정 조건 기반 자동 매매 시뮬레이션

5) 계정 기능
    - 로그인/회원가입
    - 비밀번호 변경 및 정보 수정
    - 로그아웃


## 핵심 도메인
- 주문
- 체결
- 포트폴리오(잔고 및 주식 내역)
- 랭킹
- 마켓 거래량
- 알람 (Optional)


## 핵심 도메인 별 기능 단위 명세 사항 작성
1. 사용자(User)
- 사용자를 생성한다 + 유효성을 검사한다 
  - [ ] 사용자 이름(name), 지역(location)을 입력받아 등록한다 
  - [ ] 생성 시 자동으로 생성일(created_at)을 기록한다
  - [ ] [**예외**] 이름 또는 지역이 null인 경우 예외를 발생한다
  - [ ] [**예외**] 동일한 ID로 이미 존재하는 경우 예외를 발생한다
  
- 사용자 정보를 수정한다 
  - [ ] 사용자 이름 또는 지역을 수정할 수 있다
  - [ ] [**예외**] 존재하지 않는 사용자 ID일 경우 예외를 발생한다
  - [ ] [생각하기] 수정할 정보가 없는 상황에서 수정하는 상황?? (바뀐 내용이 없는 경우에는 어떻게 생각해야 하는지?)

- 사용자를 삭제한다 (선택 사항)
- 사용자 ID로 삭제할 수 있다 
- 삭제 시 연결된 계좌 및 포트폴리오도 함께 삭제되거나 비활성화된다
- [예외] 존재하지 않는 사용자 ID일 경우 예외를 발생한다

- 사용자와 연결된 리소스를 조회한다 
  - [ ] 사용자 ID로 계좌, 포트폴리오, 보유 종목 정보를 함께 조회할 수 있다
  - [ ] [**예외**] 연결된 리소스가 없는 경우 빈 목록 또는 null로 처리된다

2. 계좌(Account)
- 계좌를 생성한다 + 유효성을 검사한다 
  - [ ] 사용자 ID, 은행명, 계좌번호를 입력받아 등록한다 
  - [ ] 생성 시 초기 잔고(available_cash)는 1천만 원으로 설정된다
  - [ ] 생성 시 계좌 활성화 상태(is_active)는 기본값으로 true로 설정된다
  - [ ] [**예외**] 사용자 ID가 null이거나 존재하지 않을 경우 예외 발생
  - [ ] [**예외**] 계좌번호 또는 은행명이 null이거나 비어있을 경우 예외 발생
  - [ ] [**예외**] 동일한 사용자가 동일한 계좌번호의 계좌를 생성하려는 경우 예외 발생 

- 계좌를 조회한다 
  - [ ] 계좌 ID 또는 사용자 ID로 계좌 정보를 조회할 수 있다 
  - [ ] 계좌의 잔고(available_cash)와 활성화 여부를 포함하여 반환한다
  - [ ] [**예외**] 존재하지 않는 계좌 ID 또는 사용자 ID일 경우 예외 발생
  
- 계좌의 잔고를 갱신한다 (주문 체결 시 반영)
  - [ ] 매수 체결 시 잔고를 차감한다 
  - [ ] 매도 체결 시 잔고를 증가시킨다
  - [ ] [**예외**] 잔고가 부족한 경우 매수 체결은 실패 처리된다
  - [ ] [**예외**] 음수 잔고가 되는 경우 예외 발생

- 계좌를 비활성화한다 
  - [ ] 계좌 ID로 계좌를 비활성화 처리할 수 있다 (is_active = false)
  - [ ] [**예외**] 이미 비활성화된 계좌를 다시 비활성화하려는 경우 예외 발생

3. 주문 (Order)
- 주문을 생성한다 + 유효성을 검사한다
  - [ ] 사용자 ID를 기반으로 주문을 생성한다
  - [ ] 주문 생성 시 상태(order_status)는 기본값으로 "CREATED"로 설정된다
  - [ ] 주문 생성 시 현재 시간을 order_date로 저장한다
  - [ ] [**예외**] 사용자 ID가 null이거나 존재하지 않는 경우 예외를 발생한다

- 주문을 조회한다
  - [ ] 주문 ID로 개별 주문을 조회할 수 있다
  - [ ] 사용자 ID로 해당 사용자의 전체 주문 목록을 조회할 수 있다
  - [ ] [**예외**] 존재하지 않는 주문 ID로 조회 시 예외를 발생한다

- 주문을 삭제한다 
  - [ ] 주문 ID로 주문을 삭제할 수 있다 
  - [ ] 삭제는 상태가 "CREATED" 또는 "PROCESSING"인 경우에만 가능하다
  - [ ] [**예외**] 주문이 "COMPLETED" 또는 "CANCELLED" 상태일 경우 삭제 불가능 예외 발생
  - [ ] [**예외**] 존재하지 않는 주문 ID일 경우 예외 발생

- 주문 상태를 변경한다
  - [ ] 상태 흐름은 "CREATED" → "PROCESSING" → "COMPLETED" 또는 "CANCELLED"
  - [ ] 상태 전이 시, 현재 상태를 기준으로 전이 가능한 상태만 허용
  - [ ] "CREATED" 또는 "PROCESSING" 상태에서만 "CANCELLED" 가능
  - [ ] [**예외**] 허용되지 않는 상태 전이 시 예외를 발생한다
  - [ ] [**예외**] 이미 완료된("COMPLETED") 주문은 변경 불가

- 주문과 연결된 종목 주문(StockOrders)을 함께 조회한다 
  - [ ] 주문 ID로 하위 종목 주문 목록을 포함하여 조회할 수 있다 
  - [ ] 주문의 총 체결 수량 및 체결 비율 계산 가능


4. 주문 상세 정보 (StockOrder)
- 종목 주문을 생성한다 + 유효성을 검사한다 
  - [ ] 주문 ID(order_id), 종목 ID(stock_id), 주문 수량(order_quantity), 주문 가격(order_price)을 입력받아 생성한다 
  - [ ] 생성 시 상태(order_status)는 "PENDING"으로 초기화된다 
  - [ ] executed_quantity, executed_price는 0 또는 null로 초기화된다
  - [**예외**] 주문 ID 또는 종목 ID가 null이거나 존재하지 않을 경우 예외 발생
  - [**예외**] 주문 수량이 0 이하인 경우 예외 발생
  - [**예외**] 주문 가격이 0 이하인 경우 예외 발생

- 종목 주문을 조회한다 
  - [ ] 종목 주문 ID로 조회할 수 있다 
  - [ ] 주문 ID로 연결된 모든 종목 주문 리스트를 조회할 수 있다
  - [**예외**] 존재하지 않는 종목 주문 ID로 조회 시 예외 발생

- 체결 정보를 갱신한다 (실시간 체결 처리)
  - [ ] 체결 수량을 누적하여 executed_quantity에 반영한다 
  - [ ] 체결 가격을 기반으로 평균 체결 단가(executed_price)를 갱신한다 
  - [ ] 전량 체결되면 상태를 "FILLED"로 전이 
  - [ ] 일부 체결 시 "PARTIALLY_FILLED" 상태로 갱신
  - [ ] [**예외**] 체결 수량이 주문 수량을 초과하면 예외 발생
  - [ ] [**예외**] 체결 수량이 0 이하, 체결 단가가 0 이하인 경우 예외 발생
  - [ ] [**예외**] 이미 "FILLED" 상태인 주문에 체결을 추가하려는 경우 예외 발생

- 주문 상태를 변경한다 
  - [ ] "PENDING" → "PARTIALLY_FILLED" → "FILLED" 순으로 전이
  - [ ] "PENDING" 또는 "PARTIALLY_FILLED" 상태에서 "CANCELLED" 전이 가능
  - [ ] [**예외**] 상태 전이가 불가능한 방향일 경우 예외 발생

- 수익률 계산 로직을 제공한다 (선택)
- 현재 가격과 executed_price를 기반으로 수익률 계산이 가능하도록 로직 제공
- [예외] 체결이 이뤄지지 않은 경우 수익률 계산은 불가

5. 포트폴리오 상세 내역 (PortfolioStocks) : 실제 사용자의 포트폴리오에 어떤 종목이 몇 주, 어떠한 평균 단가로 거래되었는지 표기
- 체결 결과를 반영해야 하고 매수 혹은 매도가 발생하면 수량 및 평균 단가가 갱신되어야 한다.
  
- 보유 종목을 등록한다 
  - [ ] 사용자의 포트폴리오 ID, 종목 ID, 수량, 평균 단가를 입력받아 신규 보유 종목으로 등록한다 
  - [ ] 최초 매수 체결 시 신규 등록된다
  - [ ] [**예외**] 포트폴리오 ID 또는 종목 ID가 null이거나 존재하지 않으면 예외 발생
  - [ ] [**예외**] 수량이 0 이하이거나 평균 단가가 0 이하인 경우 예외 발생

- 보유 종목을 갱신한다 
  - [ ] 매수 체결 시 수량 증가 및 평균 단가 갱신 
  - [ ] 매도 체결 시 수량 감소 (평균 단가는 유지)
  - [ ] 수량이 0이 되면 해당 보유 종목 삭제 처리
  - [ ] [**예외**] 보유 수량보다 많은 수량을 매도하려는 경우 예외 발생
  - [ ] [**예외**] 수량 계산 결과가 음수가 되는 경우 예외 발생

- 보유 종목을 조회한다 
  - [ ] 포트폴리오 ID로 해당 사용자의 전체 보유 종목 목록을 조회할 수 있다 
  - [ ] 특정 종목에 대해 보유 여부와 수량, 평균 단가를 확인할 수 있다
  - [ ] [**예외**] 포트폴리오 ID가 유효하지 않을 경우 예외 발생

- 보유 종목을 삭제한다 (선택)
  - [ ] 보유 수량이 0이 되면 자동 삭제 처리 또는 명시적으로 삭제할 수 있다
  - [**예외**] 존재하지 않는 보유 항목을 삭제하려는 경우 예외 발생


6. 주식종목 (Stock)
- 종목을 등록한다 + 유효성을 검사한다 
  - [ ] 종목명(stock_name), 카테고리 ID(stock_category_id), 초기 가격(stock_price), 초기 수량(available_quantity)을 입력받아 등록한다
  - [ ] [**예외**] 종목명이 null이거나 빈 문자열인 경우 예외 발생
  - [**예외**] 초기 가격 또는 수량이 0 이하인 경우 예외 발생
  - [**예외**] 카테고리 ID가 존재하지 않는 경우 예외 발생

- 종목을 조회한다 
  - [ ] 종목 ID 또는 이름으로 개별 조회할 수 있다 
  - [ ] 전체 종목 목록을 조회할 수 있다 
  - [ ] 카테고리 기준으로 종목 목록을 필터링할 수 있다
  - [**예외**] 존재하지 않는 종목 ID 또는 이름으로 조회 시 예외 발생 

- 종목의 실시간 가격을 갱신한다 
  - [ ] 체결 단가 또는 외부 마켓 가격에 따라 가격(stock_price)을 업데이트한다
  - [ ] [**예외**] 업데이트하려는 가격이 0 이하인 경우 예외 발생
  - [ ] [**예외**] 존재하지 않는 종목에 대한 갱신 요청 시 예외 발생

- 종목의 유통 가능 수량을 갱신한다 
  - [ ] 체결 시 available_quantity를 감소시킨다 (매도 수량 기준)
  - [ ] 신규 발행 또는 이벤트로 수량을 증가시킬 수도 있다
  - [ ] [**예외**] 감소 후 수량이 음수가 되면 예외 발생
  - [ ] [**예외**] 종목 ID가 유효하지 않을 경우 예외 발생

- 종목의 거래 정지 상태를 설정한다 (Optional)
  - [ ] 종목 거래를 정지(is_active = false)하거나 재개할 수 있다
  - [ ] [**예외**] 비활성화된 종목에 대해 주문 요청이 들어올 경우 예외 발생

7. 주식 종목 카테고리 (StockCategories) : 각 종목(Stocks)이 어떤 산업/분야 카테고리에 속하는지를 구분하기 위한 도메인
- 카테고리를 등록한다 + 유효성을 검사한다 
  - [ ] 카테고리명(category_name), 설명(description)을 입력받아 등록한다
  - [ ] [**예외**] 카테고리명이 null이거나 비어있을 경우 예외 발생
  - [ ] [**예외**] 동일한 이름의 카테고리가 이미 존재하는 경우 예외 발생

- 카테고리를 조회한다 
  - [ ] 전체 카테고리 목록을 조회할 수 있다 
  - [ ] 카테고리 ID 또는 이름으로 특정 카테고리를 조회할 수 있다
  - [ ] [**예외**] 존재하지 않는 카테고리 ID로 조회 시 예외 발생

- 카테고리를 삭제한다 (선택)
  - [ ] 카테고리 ID를 기준으로 삭제할 수 있다
  - [ ] [**예외**] 해당 카테고리에 종속된 종목이 있는 경우 삭제 불가 예외 발생
  - [ ] [**예외**] 존재하지 않는 카테고리를 삭제하려는 경우 예외 발생

- 카테고리에 속한 종목을 조회한다 
  - [ ] 카테고리 ID 또는 이름을 기준으로 종속된 종목 목록을 조회할 수 있다
  - [ ] [**예외**] 해당 카테고리에 종목이 하나도 없는 경우 빈 리스트를 반환

    

